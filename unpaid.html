<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Unpaid Participants Report</title>

<style>
  body {
    font-family: Arial, sans-serif;
    background: #f7f7f7;
    padding: 20px;
  }

  h1, h2 {
    text-align: center;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: #fff;
    margin-bottom: 30px;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 6px;
    text-align: center;
    font-size: 14px;
  }

  th {
    background: #8e0000;
    color: #fff;
  }

  .district-title {
    background: #2c3e50;
    color: #fff;
    padding: 8px;
    margin-top: 30px;
  }

  .summary {
    background: #fff;
    padding: 15px;
    border: 1px solid #ccc;
    font-size: 16px;
  }

  .loading {
    text-align: center;
    font-size: 18px;
  }
</style>
</head>

<body>

<h1>District Level Yoga Competition</h1>
<h2>❌ Unpaid Participants Report</h2>

<div class="loading" id="loading">Loading unpaid participants…</div>

<div id="report"></div>

<div class="summary" id="summary" style="display:none;">
  <b>Total Unpaid Participants:</b> <span id="totalUnpaid"></span>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbwMpx4F3XRvHQlTKpoBpotpJh31yZ47FPsxIbiYqiJ66l0DR9bBAXoc0Chps5cWGto/exec";

fetch(API_URL)
  .then(res => res.json())
  .then(renderReport)
  .catch(() => {
    document.getElementById("loading").innerText =
      "Unable to load unpaid report";
  });

function renderReport(data) {

  const container = document.getElementById("report");

  Object.keys(data.districts).forEach(district => {

    const title = document.createElement("div");
    title.className = "district-title";
    title.innerText = "District: " + district;
    container.appendChild(title);

    const table = document.createElement("table");
    table.innerHTML = `
      <thead>
        <tr>
          <th>S.No</th>
          <th>Name</th>
          <th>Father Name</th>
          <th>Age Group</th>
          <th>Events Selected</th>
          <th>No of Events</th>
          <th>Mobile</th>
          <th>WhatsApp</th>
          <th>Email</th>
          <th>Confirmation URL</th>
        </tr>
      </thead>
      <tbody></tbody>
    `;

    const tbody = table.querySelector("tbody");

    data.districts[district].forEach((r, i) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${r.name}</td>
        <td>${r.fatherName}</td>
        <td>${r.ageGroup}</td>
        <td>${r.eventsSelected}</td>
        <td>${r.noOfEvents}</td>
        <td>${r.mobile}</td>
        <td>${r.whatsapp}</td>
        <td>${r.email}</td>
        <td><a href="${r.confirmationUrl}" target="_blank">Link</a></td>
      `;
      tbody.appendChild(tr);
    });

    container.appendChild(table);
  });

  document.getElementById("totalUnpaid").innerText = data.totalUnpaid;
  document.getElementById("loading").style.display = "none";
  document.getElementById("summary").style.display = "";
}
</script>

</body>
</html>
